{% trans_default_domain "contao_default" %}
{% set controller_prefix = 'scw--' %}

{% set table_attributes = attrs()
    .set('id', 'ctrl_' ~ id)
    .addClass(['simple_column_wizard'])
    .set('data-controller', controller_prefix ~ 'row-wizard')
    .setIfExists('data-'~ controller_prefix ~ 'row-wizard-min-value', min_rows|default)
    .setIfExists('data-'~ controller_prefix ~ 'row-wizard-max-value', max_rows|default)
%}

<table{{ table_attributes }}>
    <thead>
    <tr>
        {% if sortable and reverseSortable %}
            <th></th>
        {% endif %}
        {% for label in labels %}
            <th>{{ label }}</th>
        {% endfor %}
        <th></th>
    </tr>
    </thead>
    {% set table_body_attributes = attrs()
        .addClass('sortable', sortable)
        .set('data-controller', controller_prefix ~ 'sortable', sortable)
        .set('data-' ~ controller_prefix ~ 'sortable-handle-value', '.drag-handle', sortable)
        .set('data-action', controller_prefix ~ 'sortable:update->' ~ controller_prefix ~ 'row-wizard#updateSorting', sortable)
        .set('data-' ~ controller_prefix ~ 'row-wizard-target', 'body')
    %}

    <tbody{{ table_body_attributes }}>
        {% for row in rows %}
            <tr data-{{ controller_prefix }}row-wizard-target="row">
                {% if sortable and reverseSortable %}
                    <td>
                        {% set drag_handle_attributes = attrs()
                            .set('type', 'button')
                            .set('data-action', 'keydown->' ~ controller_prefix ~ 'sortable#move')
                            .addClass(['drag-handle', 'scw-drag-handle'])
                        %}
                        <button{{ drag_handle_attributes}}>{{ backend_icon('drag.svg', 'MSC.move'|trans) }}</button>
                    </td>
                {% endif %}

                {% for widget in row.columns %}
                    <td>{{ widget|raw }}</td>
                {% endfor %}

                {# Controls #}
                <td class="tl_right">
                    {# Edit #}
                    {% set edit_anchor_attributes = attrs()
                        .set('title', 'MSC.editElement'|trans)
                        .addClass(['module_link', 'hidden'])
                    %}
                    <a{{ edit_anchor_attributes }}></a>

                    {# Copy row #}
                    {% set copy_button_attributes = attrs()
                        .set('type', 'button')
                        .set('data-action', controller_prefix ~ 'row-wizard#copy contao--scroll-offset#store')
                        .set('data-' ~ controller_prefix ~ 'row-wizard-target', 'copy')
                    %}
                    <button{{ copy_button_attributes }}>{{ backend_icon('copy.svg', 'MSC.mw_copy'|trans) }}</button>

                    {# Delete row #}
                    {% set delete_button_attributes = attrs()
                        .set('type', 'button')
                        .set('data-action', controller_prefix ~ 'row-wizard#delete contao--scroll-offset#store')
                        .set('data-' ~ controller_prefix ~ 'row-wizard-target', 'delete')
                    %}
                    <button{{ delete_button_attributes }}>{{ backend_icon('delete.svg', 'MSC.mw_delete'|trans) }}</button>

                    {# Enable checkbox #}
                    {% set enable_input_attributes = attrs()
                        .set('id', "#{id}_#{loop.index0}_enable")
                        .set('name', "#{id}[#{loop.index0}][enable]")
                        .set('type', 'checkbox')
                        .set('checked', condition: row.controls.enable)
                        .set('value', '1')
                        .set('data-action', 'focus->contao--scroll-offset#store')
                        .addClass('tl_checkbox mw_enable')
                    %}
                    <input{{ enable_input_attributes }}>

                    {% set enable_label_attributes = attrs()
                        .set('for', "#{id}_#{loop.index0}_enable")
                        .set('title', 'MSC.mw_enable'|trans)
                        .set('data-contao--tooltips-target', 'tooltip')
                        .set('data-action', 'click->contao--scroll-offset#store')
                        .addClass('mw_enable')
                    %}
                    <label{{ enable_label_attributes }}>{{ 'MSC.mw_enable'|trans }}</label>

                    {% if sortable and not reverseSortable %}
                        {% set drag_handle_attributes = attrs()
                            .set('type', 'button')
                            .set('data-action', 'keydown->' ~ controller_prefix ~ 'sortable#move')
                            .addClass(['drag-handle', 'scw-drag-handle'])
                        %}
                        <button{{ drag_handle_attributes}}>{{ backend_icon('drag.svg', 'MSC.move'|trans) }}</button>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
